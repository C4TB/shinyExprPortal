<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data Preparation Guide • shinyExprPortal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Preparation Guide">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shinyExprPortal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/shinyExprPortal.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/config.html">Full Configuration Guide</a></li>
    <li><a class="dropdown-item" href="../articles/customization.html">Portal UI and Code Customization</a></li>
    <li><a class="dropdown-item" href="../articles/dataprep.html">Data Preparation Guide</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/C4TB/shinyExprPortal/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Data Preparation Guide</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/C4TB/shinyExprPortal/blob/main/vignettes/dataprep.Rmd" class="external-link"><code>vignettes/dataprep.Rmd</code></a></small>
      <div class="d-none name"><code>dataprep.Rmd</code></div>
    </div>

    
    
<p>The package was developed to support the most common data shapes and
file formats used in bioinformatics. This guide describes how to
structure each file used by the portal.</p>
<p><strong>Expression matrix</strong></p>
<p>The expected format for a matrix is sample identifiers in columns and
symbols in rows. The optimal file format for the portal is an R object
of matrix type saved as an .rds file, because it will load faster,
although it is also possible to save the matrix as a CSV or TSV file. If
using the latter, ensure that the first row (with exception of the first
column) contain the sample identifiers and that the first column
contains the transcript identifiers.</p>
<blockquote>
<p><strong>Saving an RDS file</strong>: to export a matrix as an rds
file, simply run:<br><code>saveRDS(matrix_object, "matrix_object.rds")</code></p>
</blockquote>
<p>The following is a valid example of an expression matrix:</p>
<table class="table">
<colgroup>
<col width="5%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">S1_01</th>
<th align="right">S1_02</th>
<th align="right">S2_01</th>
<th align="right">S2_02</th>
<th align="right">S3_01</th>
<th align="right">S3_02</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABC</td>
<td align="right">-1.4000435</td>
<td align="right">0.2553171</td>
<td align="right">-2.4372636</td>
<td align="right">-0.0055713</td>
<td align="right">0.6215527</td>
<td align="right">1.1484116</td>
</tr>
<tr class="even">
<td align="left">BCD</td>
<td align="right">-1.8218177</td>
<td align="right">-0.2473253</td>
<td align="right">-0.2441996</td>
<td align="right">-0.2827054</td>
<td align="right">-0.5536994</td>
<td align="right">0.6289820</td>
</tr>
<tr class="odd">
<td align="left">CDE</td>
<td align="right">2.0650249</td>
<td align="right">-1.6309894</td>
<td align="right">0.5124269</td>
<td align="right">-1.8630115</td>
<td align="right">-0.5220125</td>
<td align="right">-0.0526019</td>
</tr>
<tr class="even">
<td align="left">DEF</td>
<td align="right">0.5429963</td>
<td align="right">-0.9140748</td>
<td align="right">0.4681544</td>
<td align="right">0.3629513</td>
<td align="right">-1.3045435</td>
<td align="right">0.7377763</td>
</tr>
<tr class="odd">
<td align="left">EFG</td>
<td align="right">1.8885049</td>
<td align="right">-0.0974451</td>
<td align="right">-0.9358474</td>
<td align="right">-0.0159503</td>
<td align="right">-0.8267890</td>
<td align="right">-1.5123997</td>
</tr>
<tr class="even">
<td align="left">FGH</td>
<td align="right">0.9353632</td>
<td align="right">0.1764886</td>
<td align="right">0.2436855</td>
<td align="right">1.6235489</td>
<td align="right">0.1120381</td>
<td align="right">-0.1339970</td>
</tr>
<tr class="odd">
<td align="left">GHI</td>
<td align="right">-1.9100875</td>
<td align="right">-0.2792372</td>
<td align="right">-0.3134460</td>
<td align="right">1.0673079</td>
<td align="right">0.0700349</td>
<td align="right">-0.6391233</td>
</tr>
<tr class="even">
<td align="left">HIJ</td>
<td align="right">-0.0499649</td>
<td align="right">-0.2514834</td>
<td align="right">0.4447971</td>
<td align="right">2.7554176</td>
<td align="right">0.0465314</td>
<td align="right">0.5777091</td>
</tr>
<tr class="odd">
<td align="left">IJK</td>
<td align="right">0.1181949</td>
<td align="right">-1.9117205</td>
<td align="right">0.8620865</td>
<td align="right">-0.2432367</td>
<td align="right">-0.2060872</td>
<td align="right">0.0191776</td>
</tr>
<tr class="even">
<td align="left">JKL</td>
<td align="right">0.0295608</td>
<td align="right">0.5498275</td>
<td align="right">-2.2741149</td>
<td align="right">2.6825572</td>
<td align="right">-0.3612213</td>
<td align="right">0.2133557</td>
</tr>
</tbody>
</table>
<p><strong>Measures table</strong></p>
<p>The measures table follows the format of one row per subject (even if
they have more than one sample collected) with the measures across
columns. A data.frame can be saved in an .rds file, but CSV or TSV files
are also supported.</p>
<p>Measures collected over time should be represented in separate
columns, with the convention (enforced by default) of a time code as a
suffix for measure names, separated by underscore (<code>_</code>) –
this means that underscore cannot be used in long measure names as well.
For example, for disease activity collected over four time points, the
expected names are: diseaseActivity_Baseline, diseaseActivity_Week1,
diseaseActivity_Week2 and diseaseActivity_Week3. Using the default
settings, it is invalid to use a name such as Disease_Activity_Baseline.
The time separator can be modified in the configuration file by setting
<code>timesep</code> to the desired separator.</p>
<p>The following is a valid example of a measures table:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Patient_ID</th>
<th align="right">Platelets_m01</th>
<th align="right">Platelets_m02</th>
<th align="right">Age</th>
<th align="left">drugNaive</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">p01</td>
<td align="right">235.8666</td>
<td align="right">241.8803</td>
<td align="right">54</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left">p02</td>
<td align="right">206.6894</td>
<td align="right">236.7350</td>
<td align="right">76</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">p03</td>
<td align="right">175.2997</td>
<td align="right">174.8539</td>
<td align="right">37</td>
<td align="left">No</td>
</tr>
</tbody>
</table>
<p><strong>Lookup table</strong></p>
<p>For datasets where a subject has more than one sample (e.g. samples
over time, from different tissues or combinations thereof), a lookup
table should be constructed and saved as a data.frame in an .rds file,
CSV or TSV.</p>
<p>This table maps subject identifiers to sample identifiers, with the
expression matrix containing data for <em>all</em> samples in the
dataset. The table should also contain metadata that allows subsetting
samples. For example, if subjects and samples vary over time, drug
groups and tissues, the lookup table should have one column for each
category. The following is an example of such a table:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Sample_ID</th>
<th align="left">Time</th>
<th align="left">Tissue</th>
<th align="left">Drug</th>
<th align="left">Patient_ID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">S1_01</td>
<td align="left">m01</td>
<td align="left">A</td>
<td align="left">d1</td>
<td align="left">p01</td>
</tr>
<tr class="even">
<td align="left">S1_02</td>
<td align="left">m02</td>
<td align="left">A</td>
<td align="left">d1</td>
<td align="left">p01</td>
</tr>
<tr class="odd">
<td align="left">S2_01</td>
<td align="left">m01</td>
<td align="left">A</td>
<td align="left">d1</td>
<td align="left">p02</td>
</tr>
<tr class="even">
<td align="left">S2_02</td>
<td align="left">m02</td>
<td align="left">A</td>
<td align="left">d1</td>
<td align="left">p02</td>
</tr>
<tr class="odd">
<td align="left">S3_01</td>
<td align="left">m01</td>
<td align="left">A</td>
<td align="left">d2</td>
<td align="left">p03</td>
</tr>
<tr class="even">
<td align="left">S3_02</td>
<td align="left">m02</td>
<td align="left">A</td>
<td align="left">d2</td>
<td align="left">p03</td>
</tr>
</tbody>
</table>
<p>In the case above, patients p01 and p02 belong to drug group d1,
while patient p03 belongs to group d2. All patients have samples
collected at months 1 and 2 (encoded as m01 and m02), and all samples
are from the same tissue (A). In this example, drug groups samples from
different subjects (i.e. there is no overlap of subjects between the two
drug groups).</p>
<p>The lookup table can also be enriched with other characteristics of
subjects that can be use to partition samples, such as age, sex, or
others. Outputs of methods such as clustering can also be added to the
table: this enables the exploration of correlations in different
clusters, or comparing trajectories across different clusters, for
example.</p>
<div class="section level3">
<h3 id="validation-checks">Validation checks<a class="anchor" aria-label="anchor" href="#validation-checks"></a>
</h3>
<p>The package does a very lightweight validation of the loaded files,
only checking if subjects and samples match. It does not ensure that the
correct transformations have been applied to the expression data, nor
does it warn about or modify missing data – a subject is not included in
calculations if they have a missing value for a particular measure.</p>
<p>The following checks ARE made:</p>
<p><strong>Matching samples and subjects</strong>: the package will
confirm that every sample in the expression matrix is matched to at
least one subject in the lookup table. It also checks that all subjects
in the measures table match to at least one sample in the lookup table.
That is, there can be no excess of samples or subjects in each
table.</p>
<p><strong>Matrix format:</strong> if using an .rds file, the package
will check that the expression matrix was indeed saved as a matrix
object in the rds file. This is to ensure that the rownames are read
properly.</p>
</div>
<div class="section level2">
<h2 id="additional-files">Additional files<a class="anchor" aria-label="anchor" href="#additional-files"></a>
</h2>
<div class="section level3">
<h3 id="differential-expression-analysis-results">Differential expression analysis results<a class="anchor" aria-label="anchor" href="#differential-expression-analysis-results"></a>
</h3>
<p>The package includes two modules to showcase results of differential
expression analysis (see <a href="config.html">config</a> for more
details). These modules read files created using <code>limma</code>,
<code>edgeR</code> or <code>deseq2</code>. All files should be saved
with column names and the column names must not be changed – the only
exception is you want to mix models from different packages, then you
should rename the columns so that all results have the same column names
(e.g. p-values are identified in the same way across all files).</p>
<p>These modules require the creation of a table that lists all model
results and they support the use of additional columns in the table to
organize results from different types of models or subsets of samples.
All model results file should be placed into a <code>models</code>
folder within the project folder.</p>
<p>The table should look like the following and saved in a CSV or TSV
file:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">Time</th>
<th align="left">Drug</th>
<th align="left">File</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Linear</td>
<td align="left">m01</td>
<td align="left">d1</td>
<td align="left">Model_1.txt</td>
</tr>
<tr class="even">
<td align="left">Linear</td>
<td align="left">m02</td>
<td align="left">d2</td>
<td align="left">Model_2.txt</td>
</tr>
<tr class="odd">
<td align="left">Nonlinear</td>
<td align="left">m01</td>
<td align="left">d1</td>
<td align="left">Model_3.txt</td>
</tr>
<tr class="even">
<td align="left">Nonlinear</td>
<td align="left">m02</td>
<td align="left">d2</td>
<td align="left">Model_4.txt</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="gene-moduleslists">Gene modules/lists<a class="anchor" aria-label="anchor" href="#gene-moduleslists"></a>
</h3>
<p>The heatmap module requires the creation of a table containing lists
of names such as gene symbols (see <a href="config.html">config</a> for
more details). In this table, each row will have a column that contains
the gene lists, with symbols separated by a comma. If you have a table
where you have a list identifier and a symbol in each column, you can
use a group-by operation with paste-collapse to create the required
list, as follows:</p>
<div style="display: flex;">
<div>
<p>Original file:</p>
<table class="table">
<thead><tr class="header">
<th align="left">module</th>
<th align="left">gene</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="left">ABC</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="left">DEF</td>
</tr>
<tr class="odd">
<td align="left">A</td>
<td align="left">GHI</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="left">JKL</td>
</tr>
<tr class="odd">
<td align="left">B</td>
<td align="left">MNO</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="left">PQR</td>
</tr>
</tbody>
</table>
</div>
<div class="col">
<p>  <!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div>
<p>Code to transform:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">module</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">gene</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="asking-for-help">Asking for help<a class="anchor" aria-label="anchor" href="#asking-for-help"></a>
</h3>
<p>If you have any issues with data preparation, please post it as an
issue on the package GitHub.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rafael Henkin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
